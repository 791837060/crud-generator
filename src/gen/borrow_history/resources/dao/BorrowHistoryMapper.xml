<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.coinflex.api.mortgage.dao.BorrowHistoryMapper">
    <!--结果字段映射-->
    <resultMap id="queryResultMap" type="com.coinflex.api.mortgage.domain.BorrowHistoryDO">
        <result column="id" property="id" jdbcType="VARCHAR" />
        <result column="account_id" property="accountId" jdbcType="BIGINT" />
        <result column="collateral" property="collateral" jdbcType="VARCHAR" />
        <result column="quantity" property="quantity" jdbcType="DECIMAL" />
        <result column="amount" property="amount" jdbcType="DECIMAL" />
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP" />
        <result column="business_type" property="businessType" jdbcType="VARCHAR" />
        <result column="action_type" property="actionType" jdbcType="VARCHAR" />
        <result column="execution_status" property="executionStatus" jdbcType="VARCHAR" />
        <result column="last_updated_at" property="lastUpdatedAt" jdbcType="TIMESTAMP" />
    </resultMap>

    <!--表名-->
    <sql id="TABLE_NAME">borrow_history</sql>

    <!--所有字段-->
    <sql id="ALL_COLUMNS">
            ${alias}.id,
            ${alias}.account_id,
            ${alias}.collateral,
            ${alias}.quantity,
            ${alias}.amount,
            ${alias}.created_at,
            ${alias}.business_type,
            ${alias}.action_type,
            ${alias}.execution_status,
            ${alias}.last_updated_at
    </sql>

    <!--各种查询条件-->
    <sql id="QUERY_CONDITIONS">
        <if test="id != null and id != ''">
            and ${alias}.id = #{id, jdbcType=VARCHAR}
        </if>

        <if test="accountId != null">
            and ${alias}.account_id = #{accountId, jdbcType=BIGINT}
        </if>

        <if test="collateral != null and collateral != ''">
            and ${alias}.collateral = #{collateral, jdbcType=VARCHAR}
        </if>

        <if test="quantity != null">
            and ${alias}.quantity = #{quantity, jdbcType=DECIMAL}
        </if>

        <if test="amount != null">
            and ${alias}.amount = #{amount, jdbcType=DECIMAL}
        </if>

        <if test="createdAt != null">
            and ${alias}.created_at = #{createdAt, jdbcType=TIMESTAMP}
        </if>

        <if test="businessType != null and businessType != ''">
            and ${alias}.business_type = #{businessType, jdbcType=VARCHAR}
        </if>

        <if test="actionType != null and actionType != ''">
            and ${alias}.action_type = #{actionType, jdbcType=VARCHAR}
        </if>

        <if test="executionStatus != null and executionStatus != ''">
            and ${alias}.execution_status = #{executionStatus, jdbcType=VARCHAR}
        </if>

        <if test="lastUpdatedAt != null">
            and ${alias}.last_updated_at = #{lastUpdatedAt, jdbcType=TIMESTAMP}
        </if>

    </sql>

    <!--主键条件-->
    <sql id="PK_CONDITION">where id = #{id, jdbcType=VARCHAR}</sql>

    <!--查询-->
    <select id="getRecordList" parameterType="map" resultMap="queryResultMap">
        select <include refid="ALL_COLUMNS"><property name="alias" value="a"/></include>
        from <include refid="TABLE_NAME"/> a
        <where>
            <include refid="QUERY_CONDITIONS"><property name="alias" value="a"/></include>
        </where>
        order by a.<choose><when test="orderBy != null and orderBy != ''">${orderBy}</when><otherwise>id</otherwise></choose> <choose><when test="orderDirection != null and orderDirection != ''">${orderDirection}</when><otherwise>desc</otherwise></choose>
    </select>

    <!--根据主键查询-->
    <select id="getRecordById" resultMap="queryResultMap">
        select <include refid="ALL_COLUMNS"><property name="alias" value="a"/></include>
        from <include refid="TABLE_NAME"/> a
        <include refid="PK_CONDITION"/>
    </select>

    <!--查询数量-->
    <select id="getRecordCount" parameterType="map" resultType="java.lang.Long">
        select count(*) from <include refid="TABLE_NAME"/> a
        <where>
            <include refid="QUERY_CONDITIONS"><property name="alias" value="a"/></include>
        </where>
    </select>

    <!--插入-->
    <insert id="insert" parameterType="com.coinflex.api.mortgage.domain.BorrowHistoryDO" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        
        insert into <include refid="TABLE_NAME"/> (
            id,
            account_id,
            collateral,
            quantity,
            amount,
            created_at,
            business_type,
            action_type,
            execution_status,
            last_updated_at
        )
        values (
            #{id, jdbcType=VARCHAR},
            #{accountId, jdbcType=BIGINT},
            #{collateral, jdbcType=VARCHAR},
            #{quantity, jdbcType=DECIMAL},
            #{amount, jdbcType=DECIMAL},
            #{createdAt, jdbcType=TIMESTAMP},
            #{businessType, jdbcType=VARCHAR},
            #{actionType, jdbcType=VARCHAR},
            #{executionStatus, jdbcType=VARCHAR},
            #{lastUpdatedAt, jdbcType=TIMESTAMP}
        )
    </insert>

    <!--更新-->
    <update id="update" parameterType="com.coinflex.api.mortgage.domain.BorrowHistoryDO">
        update <include refid="TABLE_NAME"/>
        <set>
            <if test="accountId != null">account_id = #{accountId, jdbcType=BIGINT},</if>
            <if test="collateral != null and collateral != ''">collateral = #{collateral, jdbcType=VARCHAR},</if>
            <if test="quantity != null">quantity = #{quantity, jdbcType=DECIMAL},</if>
            <if test="amount != null">amount = #{amount, jdbcType=DECIMAL},</if>
            <if test="createdAt != null">created_at = #{createdAt, jdbcType=TIMESTAMP},</if>
            <if test="businessType != null and businessType != ''">business_type = #{businessType, jdbcType=VARCHAR},</if>
            <if test="actionType != null and actionType != ''">action_type = #{actionType, jdbcType=VARCHAR},</if>
            <if test="executionStatus != null and executionStatus != ''">execution_status = #{executionStatus, jdbcType=VARCHAR},</if>
            <if test="lastUpdatedAt != null">last_updated_at = #{lastUpdatedAt, jdbcType=TIMESTAMP},</if>
        </set>
        <include refid="PK_CONDITION"/>
    </update>

    <!--删除-->
    <delete id="delete">
        delete from <include refid="TABLE_NAME"/> <include refid="PK_CONDITION"/>
    </delete>
</mapper>